# Node.js with React
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  awsRegion: 'us-east-1'
  ecrRepositoryName: 'frontend-1'
  containerName: 'frontend-app'
  ecsClusterName: 'frontend-1'
  ecsServiceName: 'frontend-ecs-service'
  dockerImageTag: 'latest'
  awsAccessKeyId: $(AWS-ACCESS-KEY)
  awsSecretAccessKey: $(AWS-SECRET-KEY)
  awsSessionToken: $(AWS-TOKEN)

stages:
  - stage: Build
    jobs:
      - job: Build
        steps:
          - task: Docker@2
            inputs:
              containerRegistry: 'AWS'
              repository: '$(ecrRepositoryName)'
              command: 'buildAndPush'
              Dockerfile: 'Dockerfile'
              tags: $(dockerImageTag)

